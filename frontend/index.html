<!doctype html>
<html lang="pt-BR" class="dark">
  <head>
    <meta charset="UTF-8" />
    <script>
      // Polyfills básicos para compatibilidade (sem require que quebra o app)
      window.global = window;
      window.module = { exports: {} };
      window.exports = window.module.exports;
      window.process = { env: {} };
      
      // Fix para MediaSession API errors - intercepta ANTES de qualquer código executar
      // Lista de ações suportadas oficialmente pelo MediaSession API
      const SUPPORTED_MEDIA_SESSION_ACTIONS = [
        'play', 'pause', 'seekbackward', 'seekforward', 
        'previoustrack', 'nexttrack', 'seekto', 'stop'
      ];
      
      // Função segura para registrar ações de mídia
      const safeSetActionHandler = (action, handler) => {
        try {
          // Verificar se a ação é suportada antes de tentar registrar
          if (!SUPPORTED_MEDIA_SESSION_ACTIONS.includes(action) && action !== 'enterpictureinpicture') {
            // Silenciosamente ignora ações não suportadas (como enterpictureinpicture)
            return;
          }
          
          if ('mediaSession' in navigator && 'setActionHandler' in navigator.mediaSession) {
            navigator.mediaSession.setActionHandler(action, handler);
          }
        } catch (error) {
          // Ignora silenciosamente erros de suporte a ações específicas
          // Isso previne o erro "The provided value... is not a valid enum value"
          // Não logar para evitar poluição do console
        }
      };
      
      // Substituir o setActionHandler original por uma versão segura
      // IMPORTANTE: Fazer isso ANTES de qualquer extensão tentar usar
      if ('mediaSession' in navigator) {
        try {
          if ('setActionHandler' in navigator.mediaSession) {
            const originalSetActionHandler = navigator.mediaSession.setActionHandler.bind(navigator.mediaSession);
            navigator.mediaSession.setActionHandler = function(action, handler) {
              safeSetActionHandler(action, handler);
            };
          }
        } catch (e) {
          // Ignorar se não conseguir substituir
        }
      }
      
      // Interceptar criação de mediaSession se ainda não existir
      if (!navigator.mediaSession) {
        Object.defineProperty(navigator, 'mediaSession', {
          get: function() {
            return this._mediaSession;
          },
          set: function(value) {
            this._mediaSession = value;
            if (value && 'setActionHandler' in value) {
              const original = value.setActionHandler.bind(value);
              value.setActionHandler = function(action, handler) {
                safeSetActionHandler(action, handler);
              };
            }
          },
          configurable: true
        });
      }
      
      // Handler global para capturar erros não tratados (incluindo autoPip.js de extensões)
      // IMPORTANTE: Usar capture phase e ser o primeiro handler
      window.addEventListener('error', function(event) {
        // Captura erros de extensões do navegador (chrome-extension://, moz-extension://, etc.)
        const isExtensionError = event.filename && (
          event.filename.includes('chrome-extension://') ||
          event.filename.includes('moz-extension://') ||
          event.filename.includes('safari-extension://') ||
          event.filename.includes('autoPip.js') ||
          event.filename.includes('content.ts') ||
          event.filename.includes('snippets.js') ||
          event.filename.includes('extension://')
        );
        
        // Captura erros de MediaSession e autoPip.js (pode vir de extensões do navegador)
        const isMediaSessionError = event.message && (
          event.message.includes('setActionHandler') ||
          event.message.includes('enterpictureinpicture') ||
          event.message.includes('MediaSessionAction') ||
          event.message.includes('MediaSession')
        );
        
        // Captura erros de fetch de extensões
        const isExtensionFetchError = event.message && (
          event.message.includes('Failed to fetch dynamically imported module') ||
          event.message.includes('Failed to fetch') ||
          (event.filename && (
            event.filename.includes('chrome-extension://') ||
            event.filename.includes('content.ts') ||
            event.filename.includes('snippets.js')
          ))
        );
        
        // Captura erros de "message channel closed" (extensões do navegador)
        const isMessageChannelError = event.message && (
          event.message.includes('message channel closed') ||
          event.message.includes('listener indicated an asynchronous response')
        );
        
        if (isExtensionError || isMediaSessionError || isExtensionFetchError || isMessageChannelError) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          // Não logar para evitar poluição do console
          return false;
        }
        
        // Capturar erros de inicialização do Supabase (problema de ordem de carregamento)
        // NOTA: Este erro geralmente se resolve sozinho, então vamos apenas silenciar
        if (event.message && (
          event.message.includes('Cannot access') && 
          event.message.includes('before initialization') &&
          (event.filename && event.filename.includes('supabase'))
        )) {
          // Este erro pode ser causado por ordem de carregamento ou minificação
          // Geralmente se resolve sozinho, então vamos apenas silenciar
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          // Não logar para evitar poluição do console
          return false;
        }
      }, true);
      
      // Handler para Promise rejections não tratadas
      window.addEventListener('unhandledrejection', function(event) {
        const reason = event.reason;
        const reasonMessage = reason?.message || String(reason || '');
        const reasonStack = reason?.stack || '';
        
        // Captura erros de extensões do navegador
        const isExtensionError = reasonStack && (
          reasonStack.includes('chrome-extension://') ||
          reasonStack.includes('moz-extension://') ||
          reasonStack.includes('safari-extension://') ||
          reasonStack.includes('autoPip.js') ||
          reasonStack.includes('content.ts') ||
          reasonStack.includes('snippets.js')
        );
        
        // Captura erros de MediaSession
        const isMediaSessionError = reasonMessage && (
          reasonMessage.includes('setActionHandler') ||
          reasonMessage.includes('enterpictureinpicture') ||
          reasonMessage.includes('MediaSessionAction') ||
          reasonMessage.includes('MediaSession')
        );
        
        // Captura erros de fetch de extensões
        const isExtensionFetchError = reasonMessage && (
          reasonMessage.includes('Failed to fetch dynamically imported module') ||
          reasonMessage.includes('Failed to fetch') ||
          reasonStack.includes('chrome-extension://') ||
          reasonStack.includes('content.ts') ||
          reasonStack.includes('snippets.js')
        );
        
        // Captura erros de "message channel closed" (extensões do navegador)
        const isMessageChannelError = reasonMessage && (
          reasonMessage.includes('message channel closed') ||
          reasonMessage.includes('listener indicated an asynchronous response')
        );
        
        if (isExtensionError || isMediaSessionError || isExtensionFetchError || isMessageChannelError) {
          event.preventDefault();
          event.stopPropagation();
          // Não logar para evitar poluição do console
          return;
        }
        
        // Capturar Promise rejections do Supabase
        // NOTA: Este erro geralmente se resolve sozinho, então vamos apenas silenciar
        if (reasonMessage && (
          reasonMessage.includes('Cannot access') && 
          reasonMessage.includes('before initialization')
        )) {
          event.preventDefault();
          event.stopPropagation();
          // Não logar para evitar poluição do console
          return;
        }
      });
    </script>
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags -->
    <title>Let's Roll - Plataforma de RPG de Mesa Online</title>
    <meta name="description" content="Plataforma completa para jogar RPG de mesa online. Sistema Ordem Paranormal, fichas de personagem, dados virtuais e muito mais." />
    <meta name="keywords" content="RPG, RPG de mesa, Ordem Paranormal, D&D, dados virtuais, campanha RPG" />
    <meta name="author" content="Let's Roll Team" />
    <meta name="theme-color" content="#8000FF" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Let's Roll - Plataforma de RPG de Mesa Online" />
    <meta property="og:description" content="Plataforma completa para jogar RPG de mesa online. Sistema Ordem Paranormal, fichas de personagem, dados virtuais e muito mais." />
    <meta property="og:site_name" content="Let's Roll" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Let's Roll - Plataforma de RPG de Mesa Online" />
    <meta name="twitter:description" content="Plataforma completa para jogar RPG de mesa online. Sistema Ordem Paranormal, fichas de personagem, dados virtuais e muito mais." />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Let's Roll" />
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; font-src 'self' data:; connect-src 'self' https://*.supabase.co https://www.google-analytics.com wss://*.supabase.co; frame-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';" />
  </head>
  <body>
    <div id="root"></div>
    <!-- Carregar error-handler ANTES de qualquer outro script -->
    <script src="/error-handler.js"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>


