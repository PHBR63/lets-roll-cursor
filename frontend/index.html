<!doctype html>
<html lang="pt-BR" class="dark">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Let's Roll - Plataforma de RPG de Mesa</title>
    <!-- Interceptar autoPip.js ANTES de qualquer coisa -->
    <script>
      (function() {
        'use strict';
        // Interceptar o mais cedo possível, antes de qualquer extensão
        if (typeof navigator !== 'undefined') {
          const supportedActions = ['play', 'pause', 'seekbackward', 'seekforward', 'previoustrack', 'nexttrack', 'seekto', 'stop'];
          
          // Ignorar erros de MediaSession relacionados a extensões
          const originalError = window.onerror;
          const originalUnhandledRejection = window.onunhandledrejection;
          
          window.onerror = function(message, source, lineno, colno, error) {
            if (message && typeof message === 'string' && (
              message.includes('MediaSession') || 
              message.includes('enterpictureinpicture') ||
              message.includes('setActionHandler') ||
              (source && source.includes('autoPip.js'))
            )) {
              return true; // Suprimir erro
            }
            if (originalError) {
              return originalError.call(this, message, source, lineno, colno, error);
            }
            return false;
          };

          // Também capturar unhandled rejections
          window.onunhandledrejection = function(event) {
            if (event.reason && typeof event.reason === 'object' && event.reason.message) {
              const msg = event.reason.message;
              if (msg.includes('MediaSession') || msg.includes('enterpictureinpicture') || msg.includes('setActionHandler')) {
                event.preventDefault();
                return false;
              }
            }
            if (originalUnhandledRejection) {
              return originalUnhandledRejection.call(this, event);
            }
            return true;
          };
          
          // Função para aplicar wrapper
          const wrapMediaSession = () => {
            if (navigator.mediaSession && navigator.mediaSession.setActionHandler) {
              const original = navigator.mediaSession.setActionHandler;
              try {
                Object.defineProperty(navigator.mediaSession, 'setActionHandler', {
                  value: function(action, handler) {
                    if (!supportedActions.includes(action)) {
                      return undefined;
                    }
                    try {
                      return original.call(navigator.mediaSession, action, handler);
                    } catch (e) {
                      return undefined;
                    }
                  },
                  writable: true,
                  configurable: true
                });
              } catch (e) {
                // Fallback
                navigator.mediaSession.setActionHandler = function(action, handler) {
                  if (!supportedActions.includes(action)) return undefined;
                  try {
                    return original.call(navigator.mediaSession, action, handler);
                  } catch (e) {
                    return undefined;
                  }
                };
              }
            }
          };
          
          // Tentar imediatamente
          wrapMediaSession();
          
          // Tentar após DOMContentLoaded
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', wrapMediaSession);
          }
          
          // Tentar após load
          window.addEventListener('load', wrapMediaSession);
          
          // Interceptar quando mediaSession for criado
          if (!navigator.mediaSession) {
            let mediaSessionProxy = null;
            try {
              Object.defineProperty(navigator, 'mediaSession', {
                get: function() {
                  if (!mediaSessionProxy && this._mediaSession) {
                    mediaSessionProxy = this._mediaSession;
                    wrapMediaSession();
                  }
                  return mediaSessionProxy || this._mediaSession;
                },
                set: function(value) {
                  this._mediaSession = value;
                  wrapMediaSession();
                },
                configurable: true
              });
            } catch (e) {
              // Se não conseguir, pelo menos tentar quando for acessado
            }
          }
        }
      })();
    </script>
    <script src="/error-handler.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

